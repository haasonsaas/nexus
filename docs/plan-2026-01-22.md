# Nexus Iteration Plan (2026-01-22)

## Context
- Continue closing gaps vs Clawdbot and ship “later” design-doc items.
- Integrate vector-memory backends, media transcription, and sandbox backends.
- Track Claude CLI timeouts + Clawdbot GH findings.

## Goals
1) Vector memory backends usable in real deployments.
2) Voice/audio attachments transcribed into message context.
3) Sandbox backend choice + limits wired to config.
4) Docs and example config updated to match behavior.

## Workstreams
### A) Vector Memory (pgvector + LanceDB)
- Fix pgvector migrations to be Postgres-safe.
- Add pgvector DSN fallback to `database.url` when `use_cockroachdb` is true.
- Update docs + `nexus.example.yaml` with vector_memory config block.
- Run backend unit tests.

### B) Media Transcription (Telegram voice/audio)
- Add attachment downloader interface + Telegram implementation.
- Wire media processing into gateway message handling.
- Append transcription to message content + metadata.
- Add tests for gateway media processing behavior.

### C) Sandbox Backends (Docker + Firecracker)
- Wire config to sandbox options: backend, timeout, pool size, limits, network.
- Register Firecracker backend if configured + available.
- Update docs/config examples.

### D) Competition + Research
- GH API review of Clawdbot docs (multi-agent sandbox + tools).
- Claude CLI check: confirm timeout root cause + mitigation.
- Update `docs/competition-notes.md` with latest findings.

## Testing Plan
- `go test ./internal/memory/backend/pgvector ./internal/memory/backend/lancedb`
- `go test ./internal/media/transcribe ./internal/media`
- `go test ./internal/gateway`
- `go test ./internal/tools/sandbox`

## Commit Plan
- Commit 1: Vector memory backends + docs/config.
- Commit 2: Media transcription + Telegram attachment download + tests.
- Commit 3: Sandbox backend wiring + docs.
