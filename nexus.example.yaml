# Nexus Configuration Example
# Copy this file to nexus.yaml and fill in your credentials

server:
  host: 0.0.0.0
  grpc_port: 50051
  http_port: 8080
  metrics_port: 9090

database:
  # CockroachDB connection string
  # For local dev: postgres://root@localhost:26257/nexus?sslmode=disable
  # For production: postgres://user:password@host:26257/nexus?sslmode=verify-full
  url: ${DATABASE_URL:-postgres://root@localhost:26257/nexus?sslmode=disable}
  max_connections: 25
  conn_max_lifetime: 5m

auth:
  # Generate with: openssl rand -base64 32
  jwt_secret: ${JWT_SECRET}
  token_expiry: 24h

  oauth:
    google:
      client_id: ${GOOGLE_CLIENT_ID}
      client_secret: ${GOOGLE_CLIENT_SECRET}
      redirect_url: http://localhost:8080/auth/google/callback
    github:
      client_id: ${GITHUB_CLIENT_ID}
      client_secret: ${GITHUB_CLIENT_SECRET}
      redirect_url: http://localhost:8080/auth/github/callback

session:
  # Default agent ID used for session routing
  default_agent_id: main
  # Session scope for threaded channels: "thread" or "channel"
  slack_scope: thread
  discord_scope: thread
  # Optional local memory log
  memory:
    enabled: false
    directory: memory
    max_lines: 20
    days: 2
    scope: session # session, channel, or global
  # Optional heartbeat checklist file for heartbeat-style runs
  heartbeat:
    enabled: false
    file: HEARTBEAT.md
    mode: always # always or on_demand
  # Optional memory flush reminder when sessions grow large
  memory_flush:
    enabled: false
    threshold: 80
    prompt: "Session nearing compaction. If there are durable facts, store them in memory/YYYY-MM-DD.md or MEMORY.md. Reply NO_REPLY if nothing needs attention."

workspace:
  # Optional workspace bootstrap files (Clawdbot/Clawd-style)
  enabled: false
  path: .
  max_chars: 20000
  agents_file: AGENTS.md
  soul_file: SOUL.md
  user_file: USER.md
  identity_file: IDENTITY.md
  tools_file: TOOLS.md
  memory_file: MEMORY.md

identity:
  # Optional agent identity
  name: ""
  creature: ""
  vibe: ""
  emoji: ""

user:
  # Optional user profile
  name: ""
  preferred_address: ""
  pronouns: ""
  timezone: ""
  notes: ""

channels:
  telegram:
    enabled: true
    # Get from @BotFather on Telegram
    bot_token: ${TELEGRAM_BOT_TOKEN}
    # Optional: webhook URL for production
    # webhook: https://your-domain.com/webhook/telegram

  discord:
    enabled: true
    # Get from Discord Developer Portal
    bot_token: ${DISCORD_BOT_TOKEN}
    app_id: ${DISCORD_APP_ID}

  slack:
    enabled: true
    # Get from Slack App settings
    bot_token: ${SLACK_BOT_TOKEN}      # xoxb-...
    app_token: ${SLACK_APP_TOKEN}      # xapp-... (for Socket Mode)
    signing_secret: ${SLACK_SIGNING_SECRET}

llm:
  default_provider: anthropic

  providers:
    anthropic:
      api_key: ${ANTHROPIC_API_KEY}
      default_model: claude-sonnet-4-20250514
      # Optional: for high-volume usage
      # base_url: https://api.anthropic.com

    openai:
      api_key: ${OPENAI_API_KEY}
      default_model: gpt-4o
      # Optional: for Azure OpenAI
      # base_url: https://your-resource.openai.azure.com

    google:
      api_key: ${GOOGLE_AI_API_KEY}
      default_model: gemini-pro

    openrouter:
      api_key: ${OPENROUTER_API_KEY}
      default_model: anthropic/claude-3.5-sonnet

tools:
  # Optional notes to include in the system prompt for tool conventions
  notes: ""
  # Optional file path with tool notes (merged with inline notes)
  notes_file: ""
  # Optional memory search tool
  memory_search:
    enabled: false
    directory: memory
    memory_file: MEMORY.md
    max_results: 5
    max_snippet_len: 200
    mode: hybrid # lexical, vector, or hybrid
    embeddings:
      provider: openai
      api_key: ${OPENAI_API_KEY}
      base_url: https://api.openai.com/v1
      model: text-embedding-3-small
      cache_dir: ~/.nexus/cache/embeddings
      cache_ttl: 24h
      timeout: 15s
  sandbox:
    enabled: true
    # Number of pre-warmed sandboxes
    pool_size: 5
    # Maximum execution time per request
    timeout: 30s
    limits:
      max_cpu: 1
      max_memory: 512MB
  browser:
    enabled: true
    headless: true
    # Optional: connect to remote Playwright server
    # url: http://playwright:3000
  websearch:
    enabled: true
    provider: searxng
    # SearXNG instance URL
    url: ${SEARXNG_URL:-http://localhost:8888}

plugins:
  # Optional plugin manifest search paths
  load:
    paths: []
  # Example plugin entry
  # entries:
  #   voice-call:
  #     enabled: true
  #     path: ./plugins/voice-call # directory containing nexus.plugin.json + plugin.so (or <id>.so)
  #     config:
  #       token: ${VOICE_CALL_TOKEN}
  #   sample-echo:
  #     enabled: true
  #     path: ./examples/plugins/echo
  #     config:
  #       prefix: "[echo] "

logging:
  level: info  # debug, info, warn, error
  format: json # json, text
  # Optional: output to file
  # file: /var/log/nexus/nexus.log
