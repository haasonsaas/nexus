{{define "analytics/page.html"}}
<div class="page-header">
    <h1>Analytics</h1>
    <p class="subtitle">Conversation metrics and tool usage</p>
</div>

<div class="filters-bar">
    <form class="filters-form" method="get" action="/ui/analytics">
        <div class="filter-group">
            <label for="period-filter">Period</label>
            <select id="period-filter" name="period" class="filter-select">
                <option value="24h"{{if eq .Period "24h"}} selected{{end}}>Last 24h</option>
                <option value="7d"{{if eq .Period "7d"}} selected{{end}}>Last 7d</option>
                <option value="30d"{{if eq .Period "30d"}} selected{{end}}>Last 30d</option>
                <option value="90d"{{if eq .Period "90d"}} selected{{end}}>Last 90d</option>
            </select>
        </div>
        <div class="filter-group">
            <label for="agent-filter">Agent</label>
            <input type="text" id="agent-filter" name="agent" value="{{.AgentFilter}}" class="filter-input" placeholder="Agent ID">
        </div>
        <button type="submit" class="btn btn-secondary">Apply</button>
        <button class="btn btn-secondary"
                hx-get="/ui/api/v1/analytics/overview?period={{.Period}}&agent={{.AgentFilter}}"
                hx-target="#analytics-overview"
                hx-swap="innerHTML"
                hx-trigger="click">
            Refresh
        </button>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h3>Overview</h3>
    </div>
    <div class="card-body" id="analytics-overview">
        {{template "analytics/overview.html" .Overview}}
    </div>
</div>
{{end}}

{{define "analytics/overview.html"}}
{{if .}}
<div class="status-grid">
    <div class="status-card card">
        <div class="card-header">
            <h3>Volume</h3>
        </div>
        <div class="card-body">
            <div class="metrics-list">
                <div class="metric">
                    <span class="metric-label">Conversations</span>
                    <span class="metric-value">{{.TotalConversations}}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Messages</span>
                    <span class="metric-value">{{.TotalMessages}}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Avg msg / conversation</span>
                    <span class="metric-value">{{printf "%.1f" .AvgMessagesPerConversation}}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="status-card card">
        <div class="card-header">
            <h3>Tools</h3>
        </div>
        <div class="card-body">
            <div class="metrics-list">
                <div class="metric">
                    <span class="metric-label">Tool calls</span>
                    <span class="metric-value">{{.ToolCalls}}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Tool results</span>
                    <span class="metric-value">{{.ToolResults}}</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Tool error rate</span>
                    <span class="metric-value">{{printf "%.1f%%" .ToolErrorRatePct}}</span>
                </div>
            </div>

            {{if .TopTools}}
            <div class="table-responsive" style="margin-top: 12px;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Tool</th>
                            <th>Calls</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .TopTools}}
                        <tr>
                            <td class="mono">{{.Tool}}</td>
                            <td class="mono">{{.Count}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <p class="text-muted" style="margin-top: 12px;">No tool calls in this period</p>
            {{end}}
        </div>
    </div>

    <div class="status-card card">
        <div class="card-header">
            <h3>Messages per day</h3>
        </div>
        <div class="card-body">
            {{if .MessagesPerDay}}
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Messages</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .MessagesPerDay}}
                        <tr>
                            <td class="mono">{{.Day}}</td>
                            <td class="mono">{{.Count}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <p class="text-muted">No messages in this period</p>
            {{end}}
        </div>
    </div>
</div>

<p class="text-muted" style="margin-top: 12px;">
    Period: {{.Period}} · Agent: {{.AgentID}} · {{.Since | formatTime}} → {{.Until | formatTime}}
</p>
{{else}}
<p class="text-muted">Analytics are not available.</p>
{{end}}
{{end}}

